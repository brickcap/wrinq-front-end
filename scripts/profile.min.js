function autoGrow(e){e.scrollHeight>e.clientHeight&&(e.style.height=e.scrollHeight+"px")}function createImage(e){console.log("creating image"),preview.innerHTML="";var t=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?*=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,n=e.replace(t,function(e){return e.indexOf(".jpg")>0||e.indexOf(".jpeg")>0||e.indexOf(".png")>0||e.indexOf(".gif")>0?preview.innerHTML='<img id="profileimage" src="'+e+'">'+"<br/>":preview.innerHTML=""})}function getStore(e,t){var n=database.transaction([e],t),r=n.objectStore(e);return r}function updateProfile(){notification.innerHTML="";var e=getStore("profile","readwrite"),t=document.getElementById("profileimage"),n={pic:t?t.src:"",about:about.value,name:userName.value};if(!n.pic&&!n.about&&!n.name)return;var r=e.put(n,"master");r.onsuccess=function(){localStorage.setItem("sent",JSON.stringify([])),notification.innerHTML="<a href='/'>Profile saved</a>"},r.onerror=function(e){notification.innerHTML="Could not save profile"}}var preview=document.getElementById("imagepreview"),userName=document.getElementById("name"),profilePic=document.getElementById("profilepic"),about=document.getElementById("abouttext"),notification=document.getElementById("notification"),openRequest=indexedDB.open("wrinq",1),database;openRequest.onsuccess=function(e){database=e.target.result;var t=getStore("profile","readonly"),n=t.get("master");n.onsuccess=function(e){var t=e.target.result;document.getElementsByTagName("body")[0].style.display="block";if(!t)return;profilePic.value=t.pic,userName.value=t.name,about.value=t.about,profilePic.value&&createImage(profilePic.value)}}